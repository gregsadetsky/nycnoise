{% load get_gcal_link_from_event %}
{% load get_item %}
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>nyc noise</title>
  <style>
      body {
        background-color: #d4d0c7;
        font-family: "Open Sans", sans-serif;
      }

      #centered_content
      {
        max-width:42em; margin:15px auto;
      }

      div.event {
        margin-bottom: 5px;
      }

      div.event.cancelled {
        text-decoration: line-through;
        color: #666;
      }

      div.event.cancelled a {
        color: #666;
      }

      div.event:not(.cancelled) .eventPreface {
        display: inline;
      }

      div.event.cancelled .eventPreface {
        text-decoration: none;
        /* this is the weird trick to un-text-decorate this child element */
        display: inline-block;
        color: black;
      }

      span.smallInfo {
        font-size: 0.85em;
      }

      .eventDescription {
        font-size: 0.85rem;
      }

      /* ignore first p, i.e. make it not a block level element */
      .eventDescription, .eventDescription p:first-child, .eventPreface p:first-child
      {
        display: inline;
      }

      a {
        color: blue;
      }
  </style>
  {% include 'core/opengraph.html' %}
  {% include "calendar/style.html" %}
</head>
<body>

<div id='centered_content'>
  <h1 style='margin-bottom:0'>nyc noise</h1>
  <small>~ always incomplete ~</small>

  {% include "calendar/calendar.html" %}

  {% for date, events in all_events.items %}
    <h4>{{ date|date:"M d (D)"|lower }}</h4>

    {% if date in date_messages %}
      {% for message in date_messages|get_item:date %}
        <h4>{{ message }}</h4>
      {% endfor %}
    {% endif %}

    {% for event in events %}
      <div class='event {% if event.is_cancelled %}cancelled{% endif %}'>
        {% if event.preface %}<div class='eventPreface'>{{ event.preface|safe }}&nbsp;</div>{% endif %}â€¢

        {% if event.starttime_override %}
          {{ event.starttime_override }}:
        {% else %}
          {{ event.starttime|date:"gA"|lower }}:
        {% endif %}

        {% comment %}
          if title and artists are present, show title in not bold, and artists in bold
          also check if hyperlink is present or not to see whether artists is hyperlinked (in addition to being bold)

          if only title or artists are present, show either one of them in bold
          and also check whether hyperlink is present...
        {% endcomment %}

        {% spaceless %}
          {% if event.hyperlink %}
            <a href="{{ event.hyperlink }}" target="_blank">
          {% endif %}

          {% if event.title and event.artists %}
            {{ event.title }}:
            <span style="font-weight:bold">{{ event.artists }}</span>
          {% elif event.title %}
            <span style="font-weight:bold">{{ event.title }}</span>
          {% elif event.artists %}
            <span style="font-weight:bold">{{ event.artists }}</span>
          {% endif %}

          {% if event.hyperlink %}
            </a>
          {% endif %}
        {% endspaceless %}


        {% if event.ticket_hyperlink %}
          <a href="{{ event.ticket_hyperlink }}" target="_blank" style='font-weight:bold; color:#000000'>(tix)</a>
        {% endif %}

        {% if event.price %}
          ({{ event.price }})
        {% endif %}

        {% if event.venue_override %}
          @ {{ event.venue_override }}
        {% elif event.venue %}
          @

          {% if event.age_policy and event.venue.neighborhood_and_borough %}
            {{ event.venue.name }} ({{ event.age_policy }}), {{ event.venue.neighborhood_and_borough }}
          {% elif event.age_policy %}
            {{ event.venue.name }} ({{ event.age_policy }})
          {% elif event.venue.neighborhood_and_borough %}
            {{ event.venue.name }}, {{ event.venue.neighborhood_and_borough }}
          {% else %}
            {{ event.venue.name }}
          {% endif %}

          {% if event.venue.accessibility_emoji or event.venue.accessibility_notes or event.venue.accessibility_link %}
            <span class='smallInfo'>
            //
              {% if event.venue.accessibility_link %}<a href="{{ event.venue.accessibility_link }}" target="_blank" style="color:#008080">ACCESS</a>{% else %}ACCESS{% endif %}:
              {% if event.venue.accessibility_emoji %}
                {{ event.venue.accessibility_emoji }}
              {% endif %}
              {% if event.venue.accessibility_notes %}
                {{ event.venue.accessibility_notes }}
              {% endif %}
            </span>
          {% endif %}
        {% else %}
          Unknown venue
        {% endif %}

        {% if event.description %}
          //
          <div class='eventDescription'>{{ event.description | safe }}</div>
        {% endif %}

        //
        <a href="{% url 'event_ics_download' event.id %}" style="color:#000000; font-size: 0.85rem;">ICAL</a>
        //
        <a href="{% get_gcal_link_from_event event %}" style="color:#000000; font-size: 0.85rem;">GCAL</a>

        {% if event.venue and not event.venue_override and event.venue.google_maps_link %}
          //
          <a href="{{ event.venue.google_maps_link }}" target="_blank" class='smallInfo' style="color:#993366; font-size: 0.85rem;">MAP</a>
        {% endif %}
        
      </div>
    {% endfor %}
  {% endfor %}
</div>

</body>
</html>
